<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="CryoSamba: Self-Supervised Deep Volumetric Denoising for Cryo-Electron Tomography Data # For Hardware Issues please refer to the Nvidia-CUDA section # For Software Issues please refer to the Python section, Using Conda Environment # This repository contains the denoising pipeline described in the following publication:
Jose Inacio Costa-Filho, Liam Theveny, Marilina de Sautu, Tom Kirchhausen CryoSamba: Self-Supervised Deep Volumetric Denoising for Cryo-Electron Tomography Data
Please cite this publication if you are using this code in your research.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/docs/active-projects/cryosamba/project/">
  <meta property="og:site_name" content="TKLab Wiki">
  <meta property="og:title" content="CryoSamba Main">
  <meta property="og:description" content="CryoSamba: Self-Supervised Deep Volumetric Denoising for Cryo-Electron Tomography Data # For Hardware Issues please refer to the Nvidia-CUDA section # For Software Issues please refer to the Python section, Using Conda Environment # This repository contains the denoising pipeline described in the following publication:
Jose Inacio Costa-Filho, Liam Theveny, Marilina de Sautu, Tom Kirchhausen CryoSamba: Self-Supervised Deep Volumetric Denoising for Cryo-Electron Tomography Data
Please cite this publication if you are using this code in your research.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">
    <meta property="article:published_time" content="2024-08-15T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-08-15T00:00:00+00:00">
<title>CryoSamba Main | TKLab Wiki</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" >
<link rel="canonical" href="http://localhost:1313/docs/active-projects/cryosamba/project/">
<link rel="stylesheet" href="/book.min.6a8e8c563a407af46b9a0997cac041d5d859194e46d2344246bfc4511f5ea62d.css" integrity="sha256-ao6MVjpAevRrmgmXysBB1dhZGU5G0jRCRr/EUR9epi0=" crossorigin="anonymous">
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.043e6fd99a8bb476f3445b14f8e7ecaeb0e0569841b0bf1e5804b3c33507415f.js" integrity="sha256-BD5v2ZqLtHbzRFsU&#43;OfsrrDgVphBsL8eWASzwzUHQV8=" crossorigin="anonymous"></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk=" crossorigin="anonymous"></script>

  

<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>TKLab Wiki</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <span>Active Projects</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a96e0855703b9afc254b1c8447ed29b5" class="toggle"  />
    <label for="section-a96e0855703b9afc254b1c8447ed29b5" class="flex justify-between">
      <a role="button" class="">Asem</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/active-projects/asem/project/" class="">ASEM</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a78baf401048783b4b14a708b67f7145" class="toggle" checked />
    <label for="section-a78baf401048783b4b14a708b67f7145" class="flex justify-between">
      <a role="button" class="">Cryosamba</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/active-projects/cryosamba/paper/" class="">BioArchive</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/active-projects/cryosamba/project/" class="active">CryoSamba Main</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/active-projects/cryosamba/advanced/" class="">From Scratch(Advanced)</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-06dfe6d05518a90614b0b8737b771aca" class="toggle"  />
    <label for="section-06dfe6d05518a90614b0b8737b771aca" class="flex justify-between">
      <a role="button" class="">Care</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-fa71f318b3309fa9d5b96fe96590e2c6" class="toggle"  />
    <label for="section-fa71f318b3309fa9d5b96fe96590e2c6" class="flex justify-between">
      <a role="button" class="">Image Recognition</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Git Hub</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/github/github/" class="">GitHub</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Nvidia Cuda</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/nvidia-cuda/deeplearningsetup/" class="">NVIDIA GPU and CUDA Setup Guide</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Python</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/python/production_poetry/" class="">Poetry: Python Dependency Management Made Easy</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/python/conda_env/" class="">Using Conda Environment</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/python/python-virtual-environment/" class="">Using Python Without Breaking Your Local Machine!</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Get Started</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-44c7adc40db3ed089d926948e95a1066" class="toggle"  />
    <label for="section-44c7adc40db3ed089d926948e95a1066" class="flex justify-between">
      <a role="button" class="">Getting Started at Tklab</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/getstarted/gettingstartedattklab/quickstart/" class="">Getting Started with the TKLAB Compute</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/getstarted/gettingstartedattklab/slurm/" class="">SLURM for the CPU Cluster</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/getstarted/ssh/" class="">Access Resources Directly from Off-site with Key-Based SSH</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/getstarted/remote_access/" class="">Remotely Access Machines/Access Compute</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Lab Computing Site</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/labcomputingsite/labcomputingsite/" class="">Lab Computing Site</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-9bcf71ebb511752b18ff49427dd20961" class="toggle"  />
    <label for="section-9bcf71ebb511752b18ff49427dd20961" class="flex justify-between">
      <a role="button" class="">Care</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/labcomputingsite/care/care/" class="">Lab Computing Site/CARE</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-d35f86211aac97dd8c772bdfa9849424" class="toggle"  />
    <label for="section-d35f86211aac97dd8c772bdfa9849424" class="flex justify-between">
      <a role="button" class="">Llsm Ao Lls ( Mosaic)</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/labcomputingsite/llsm_ao-lls_mosaic/llsm/" class="">LLSM</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a98955eae6f10c3e4266a56732f9aa1d" class="toggle"  />
    <label for="section-a98955eae6f10c3e4266a56732f9aa1d" class="flex justify-between">
      <a role="button" class="">References</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/labcomputingsite/references/references/" class="">Websites, References, Githubs</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-cf9d1b781624480f957fe4d61495c4ba" class="toggle"  />
    <label for="section-cf9d1b781624480f957fe4d61495c4ba" class="flex justify-between">
      <a role="button" class="">Tracking</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/labcomputingsite/tracking/detection_and_tracking/" class="">Detection and Tracking</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/labcomputingsite/tracking/post-tracking/" class="">Post-tracking Processing</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/labcomputingsite/tracking/lab_view/" class="">Tracks Visualizer - Matlab</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/labcomputingsite/neuroglancer/" class="">Neuroglancer</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <span>Sbgrid Wiki</span>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/sbgrid_wiki/sbgrid/" class="">SBGrid Wiki</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>















</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>CryoSamba Main</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#for-hardware-issues-please-refer-to-the-nvidia-cuda-section">For Hardware Issues please refer to the Nvidia-CUDA section</a></li>
    <li><a href="#for-software-issues-please-refer-to-the-python-section-using-conda-environment">For Software Issues please refer to the Python section, Using Conda Environment</a></li>
    <li><a href="#table-of-contents">Table of Contents</a></li>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#cli-tool">CLI Tool</a>
      <ul>
        <li><a href="#installation">Installation</a></li>
        <li><a href="#using-the-tool">Using the Tool</a></li>
      </ul>
    </li>
    <li><a href="#terminal">Terminal</a>
      <ul>
        <li><a href="#installation-1">Installation</a></li>
        <li><a href="#training">Training</a></li>
        <li><a href="#visualization-with-tensorboard">Visualization with TensorBoard</a></li>
        <li><a href="#inference">Inference</a></li>
      </ul>
    </li>
    <li><a href="#ui">UI</a>
      <ul>
        <li><a href="#please-watch-the-videos-in-the-github-move_to_remote_servermp4-install_and_startupmp4-and-how_to_runmp4-to-see-an-end-to-end-example-of-running-cryosamba">PLEASE WATCH THE VIDEOS IN THE GITHUB (move_to_remote_server.mp4, install_and_startup.mp4 and How_to_run.mp4 to see an end-to-end example of running CryoSamba)</a></li>
      </ul>
    </li>
    <li><a href="#instructions-for-setting-up-cuda">Instructions for Setting Up CUDA</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="cryosamba-self-supervised-deep-volumetric-denoising-for-cryo-electron-tomography-data">
  CryoSamba: Self-Supervised Deep Volumetric Denoising for Cryo-Electron Tomography Data
  <a class="anchor" href="#cryosamba-self-supervised-deep-volumetric-denoising-for-cryo-electron-tomography-data">#</a>
</h1>
<h2 id="for-hardware-issues-please-refer-to-the-nvidia-cuda-section">
  For Hardware Issues please refer to the Nvidia-CUDA section
  <a class="anchor" href="#for-hardware-issues-please-refer-to-the-nvidia-cuda-section">#</a>
</h2>
<h2 id="for-software-issues-please-refer-to-the-python-section-using-conda-environment">
  For Software Issues please refer to the Python section, Using Conda Environment
  <a class="anchor" href="#for-software-issues-please-refer-to-the-python-section-using-conda-environment">#</a>
</h2>
<p>This repository contains the denoising pipeline described in the following publication:</p>
<blockquote>
<p>Jose Inacio Costa-Filho, Liam Theveny, Marilina de Sautu, Tom Kirchhausen<!-- raw HTML omitted -->
  <a href="https://www.biorxiv.org/content/10.1101/2024.07.11.603117v1">CryoSamba: Self-Supervised Deep Volumetric Denoising for Cryo-Electron Tomography Data</a><!-- raw HTML omitted --></p>
<p>Please cite this publication if you are using this code in your research. For installation, UI, and code setup questions, reach out to 
  <a href="https://www.linkedin.com/in/arkashj/">Arkash Jain</a> at 
  <a href="mailto:arkash@tklab.hms.harvard.edu">arkash@tklab.hms.harvard.edu</a></p>
</blockquote>
<p>‚ùó<strong>WARNING</strong>‚ùó CryoSamba is written for machines with either a <strong>Linux</strong> or <strong>Windows</strong> operating system and a <strong>CUDA capable GPU</strong>. <strong>MacOS is not supported</strong>.</p>
<p>‚ùó<strong>WARNING</strong>‚ùóMake sure you have <strong>CUDA</strong> drivers installed and updated on your machine. CryoSamba requires <strong>CUDA 11</strong> to run. Support for CUDA 12 will be added soon. Refer to 
  <a href="/#instructions-for-setting-up-cuda">Instructions for Setting Up CUDA</a> for more support.</p>
<p>These instructions are meant to be read <strong>carefully</strong> and <strong>line by line</strong>. Arbitrarily skipping lines or blindly copy-pasting code snippets will likely lead to errors.</p>
<p>üí•<strong>IMPORTANT</strong>üí• CryoSamba accepts as input (.mrc, .rec, .tif) single 3D files or sequences of 2D (.tif) files. For single files, the &ldquo;data path&rdquo; must directly reference the files, while for tif sequences the &ldquo;data path&rdquo; should reference the folder containing the sequence. For example, use <code>path/to/sample_data.rec</code> or <code>path/to/tif_folder</code>. Not referencing the input data properly will lead to errors.</p>
<h2 id="table-of-contents">
  Table of Contents
  <a class="anchor" href="#table-of-contents">#</a>
</h2>
<ol>
<li>
  <a href="/#overview">Overview</a> üåê</li>
<li>
  <a href="/#cli-tool">CLI Tool</a> üìü
<ul>
<li>
  <a href="/#installation">Installation</a> üõ†Ô∏è</li>
<li>
  <a href="/#using-the-tool">Using the tool</a> üî®</li>
</ul>
</li>
<li>
  <a href="/#terminal">Terminal</a> üíª
<ul>
<li>
  <a href="/#installation">Installation</a> üõ†Ô∏è</li>
<li>
  <a href="/#training">Training</a> üöÄ</li>
<li>
  <a href="/#visualization-with-tensorboard">(OPTIONAL) Visualization with TensorBoard</a> üìà</li>
<li>
  <a href="/#inference">Inference</a> üîç</li>
</ul>
</li>
<li>
  <a href="/#ui">UI</a> üéÆ</li>
<li>
  <a href="/#instructions-for-setting-up-cuda">Instructions for Setting Up CUDA</a></li>
<li>
  <a href="/#faq">FAQ</a></li>
</ol>
<h2 id="overview">
  Overview
  <a class="anchor" href="#overview">#</a>
</h2>
<p>CryoSamba can be run via Terminal, via a CLI Tool or via a UI (<strong>work in progress</strong>).</p>
<p>If you have access to a graphical interface, try the 
  <a href="/#ui">UI</a>.</p>
<p>If you do not have access to a graphical interface, try the 
  <a href="/#cli-tool">CLI Tool</a>. This is usually the case if you want to run CryoSamba on your university&rsquo;s HPC. <strong>This the recommended option!</strong></p>
<p>If you are a more experience programmer and comfortable with using the Terminal, try our &ldquo;raw&rdquo; 
  <a href="/#terminal">Terminal</a> instructions. <strong>We recommend using this only if you were already able to run CryoSamba via one of the previous options</strong>.</p>
<p>Finally, if you want to use CryoSamba on Windows, have a deeper understanding of the source code, change the optional parameters, or alter/use the code for your research, refer to the 
  <a href="https://github.com/kirchhausenlab/Cryosamba/blob/main/advanced_instructions.md">advanced instructions</a>.</p>
<p>Our goal is to make CryoSamba as accessible as possible.</p>
<h2 id="cli-tool">
  CLI Tool
  <a class="anchor" href="#cli-tool">#</a>
</h2>
<p>‚ùó<strong>WARNING</strong>‚ùó These instructions require you to know how to open a terminal window on your computer, how to navigate through folders and how to copy files around.</p>
<p>Note: these instructions are designed for machines with a <strong>Linux</strong> operating system. For <strong>Windows</strong>, refer to the 
  <a href="https://github.com/kirchhausenlab/Cryosamba/blob/main/advanced_instructions.md">advanced instructions</a>.</p>
<h3 id="installation">
  Installation
  <a class="anchor" href="#installation">#</a>
</h3>
<ol>
<li>Open a Terminal window and navigate to the directory where you want to save the Cryosamba code via <code>cd /path/to/dir</code>.</li>
</ol>
<p>Note: the expression <code>/path/to/dir</code> is not meant to be copy-pasted as it is. It is a general expression which means that you should replace it with the actual path to the desired directory in your own computer. Since we do not have access to your computer, we cannot give you the exact expression to copy-paste. This expression will appear several times throughout these instructions.</p>
<ol start="2">
<li>If you received CryoSamba via a zip file, run</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>unzip path/to/Cryosamba.zip
</span></span></code></pre></div><p>in this directory. <strong>Otherwise</strong>, run</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git clone https://github.com/kirchhausenlab/Cryosamba.git
</span></span></code></pre></div><p>These two options are <strong>mutually exclusive</strong>.</p>
<ol start="3">
<li>
<p>Once successfully cloned/unzipped, navigate to the scripts folder via <code>cd path/to/Cryosamba/automate/scripts</code></p>
</li>
<li>
<p>To setup the environment, run:</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>chmod -R u+x *.sh
</span></span><span style="display:flex;"><span>./startup_script_.sh
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># In case of permission issues run the command below (OPTIONAL)</span>
</span></span><span style="display:flex;"><span>chmod u+x ./name_of_file_ending_with.sh
</span></span></code></pre></div><p>This creates a conda environment called <code>cryosamba</code> and activates it. In the future, you will need to run</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>conda activate cryosamba
</span></span></code></pre></div><p>anytime you want to run CryoSamba again.</p>
<p>In case of errors, try running <code>conda init --all &amp;&amp; source ~/.bashrc</code> in your terminal.</p>
<h3 id="using-the-tool">
  Using the Tool
  <a class="anchor" href="#using-the-tool">#</a>
</h3>
<p>From the directory <code>CryoSamba/automate</code>, run</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>python run_cryosamba_cli.py
</span></span></code></pre></div><p>and follow the instructions that appear on the Terminal window.</p>
<h2 id="terminal">
  Terminal
  <a class="anchor" href="#terminal">#</a>
</h2>
<p>‚ùó<strong>WARNING</strong>‚ùó These instructions require you to know how to open a terminal window on your computer, how to navigate through folders and how to copy files around.</p>
<p>Note: these instructions are designed for machines with a <strong>Linux</strong> operating system. For <strong>Windows</strong>, refer to the 
  <a href="https://github.com/kirchhausenlab/Cryosamba/blob/main/advanced_instructions.md">advanced instructions</a>.</p>
<h3 id="installation-1">
  Installation
  <a class="anchor" href="#installation-1">#</a>
</h3>
<ol>
<li>Open a Terminal window and navigate to the directory where you want to save the Cryosamba code via <code>cd /path/to/dir</code>.</li>
</ol>
<p>Note: the expression <code>/path/to/dir</code> is not meant to be copy-pasted as it is. It is a general expression which means that you should replace it with the actual path to the desired directory in your own computer. Since we do not have access to your computer, we cannot give you the exact expression to copy-paste. This expression will appear several times throughout these instructions.</p>
<ol start="2">
<li>If you received CryoSamba via a zip file, run</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>unzip path/to/Cryosamba.zip
</span></span></code></pre></div><p>in this directory. <strong>Otherwise</strong>, run</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git clone https://github.com/kirchhausenlab/Cryosamba.git
</span></span></code></pre></div><p>These two options are <strong>mutually exclusive</strong>.</p>
<ol start="3">
<li>
<p>Once successfully cloned/unzipped, navigate to the scripts folder via <code>cd path/to/Cryosamba/automate/scripts</code></p>
</li>
<li>
<p>To setup the environment, run:</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>chmod -R u+x *.sh
</span></span><span style="display:flex;"><span>./startup_script_.sh
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># In case of permission issues run the command below (OPTIONAL)</span>
</span></span><span style="display:flex;"><span>chmod u+x ./name_of_file_ending_with.sh
</span></span></code></pre></div><p>This creates a conda environment called <code>cryosamba</code> and activates it. In the future, you will need to run</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>conda activate cryosamba
</span></span></code></pre></div><p>anytime you want to run CryoSamba again.</p>
<p>In case of errors, try running <code>conda init --all &amp;&amp; source ~/.bashrc</code> in your terminal.</p>
<h3 id="training">
  Training
  <a class="anchor" href="#training">#</a>
</h3>
<p>From the same directory <code>automate/scripts</code>, run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./setup_experiment_training.sh
</span></span></code></pre></div><p>The script asks you to enter the following parameters:</p>
<ul>
<li>Experiment name: it will create the following folder structure</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cryosamba
</span></span><span style="display:flex;"><span>‚îú‚îÄ‚îÄ runs
</span></span><span style="display:flex;"><span>    ‚îú‚îÄ‚îÄ exp-name
</span></span><span style="display:flex;"><span>       ‚îú‚îÄ‚îÄ train
</span></span><span style="display:flex;"><span>       ‚îú‚îÄ‚îÄ inference
</span></span><span style="display:flex;"><span>       train_config.json
</span></span></code></pre></div><ul>
<li>
<p>Data path: it must be either</p>
<ul>
<li>The full path to a single (3D) .tif, .mrc or .rec file, or</li>
<li>The full path to a folder containing a sequence of (2D) .tif files, ordered alphanumerically matching the Z-stack order.</li>
</ul>
<p><em>Note: Ensure consistent zero-fill in file names to maintain proper order (e.g., <code>frame000.tif</code> instead of <code>frame0.tif</code>).</em></p>
</li>
<li>
<p>Max frame gap: explained in the manuscript. We empirically set values of 3, 6 and 10 for data at voxel resolutions of 15.72√Ö, 7.86√Ö and 2.62√Ö, respectively. For different resolutions, try a reasonable value interpolated from the reference ones.</p>
</li>
<li>
<p>Number of iterations: for how many iterations the training session will run</p>
</li>
<li>
<p>Batch Size: number of data points passed at once to the GPUs. Higher number leads to faster training, but the whole batch might not fit into your GPU&rsquo;s memory, leading to <strong>out-of-memory errors</strong>. If you&rsquo;re getting these, try decreasing the batch size until they disappear. This number should be a multiple of two.</p>
</li>
</ul>
<p>The generated <code>train_config.json</code> file will contain all parameters for training the model. If you want to change other parameters, edit the <code>.json</code> file directly. In 
  <a href="https://github.com/kirchhausenlab/Cryosamba/blob/main/advanced_instructions.md">advanced instructions</a> we provide a full explanation of all config parameters.</p>
<p>To start training the model, run the command below from the same folder <code>automate/scripts</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./train_data.sh
</span></span></code></pre></div><p>To interrupt training, press CTRL + C. You can resume training or start from scratch if prompted.</p>
<p>Training will run until the maximum number of iterations is reached. However, training and validation losses might converge/stabilize before that, at which point you can safely halt the process and save time and money on your electricity bill. In order to monitor the losses&rsquo; progress you can: 1) see the logs printed on your screen, 2) see the <code>runtime.log</code> file inside your training folder, or 3) visualize their plots with TensorBoard.</p>
<p><strong>The output of the training run will be checkpoint files containing the trained model weights</strong>. There is no denoised data output at this point yet. You can used the trained model weights to run inference on your data and then get the denoised outputs.</p>
<h3 id="visualization-with-tensorboard">
  Visualization with TensorBoard
  <a class="anchor" href="#visualization-with-tensorboard">#</a>
</h3>
<p><strong>This step is OPTIONAL</strong></p>
<p>TensorBoard can be used to monitor the progress of the training losses.</p>
<ol>
<li>Open a terminal window inside a graphical interface (e.g., XDesk).</li>
<li>Activate the environment and run:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>tensorboard --logdir /path/to/dir/Cryosamba/runs/exp-name/train
</span></span></code></pre></div></li>
<li>In a browser, open <code>localhost:6006</code>.</li>
<li>Use the slider under <code>SCALARS</code> to smooth noisy plots.</li>
</ol>
<h3 id="inference">
  Inference
  <a class="anchor" href="#inference">#</a>
</h3>
<p>From the same directory <code>automate/scripts</code>, run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./setup_inference.sh
</span></span></code></pre></div><p>The script asks you to enter the following parameters:</p>
<ul>
<li>Experiment name: same as in training (should be an existing one)</li>
<li>Data path: same as in training</li>
<li>Max frame gap: usually twice the value used for training</li>
<li>TTA: whether to use Test-Time Augmentation or not (see manuscript)</li>
</ul>
<p>The generated <code>inference_config.json</code> file will contain all parameters for running inference. If you want to change other parameters, edit the <code>.json</code> file directly.</p>
<p>To start inference, run the command below from the same folder <code>automate/scripts</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./run_inference.sh
</span></span></code></pre></div><p>To interrupt the process, press CTRL + C. You can resume or start from scratch if prompted.</p>
<p><strong>The output of the inference run will be the final denoised volume</strong>, located at <code>/path/to/dir/runs/exp-name/inference</code>. It will be either a file named <code>result.tif</code>, <code>result.mrc</code>, <code>result.rec</code> or a folder named <code>result</code>.</p>
<p>You can simply open the final denoised volume in your preferred data visualization/processing software and check how it looks like.</p>
<h2 id="ui">
  UI
  <a class="anchor" href="#ui">#</a>
</h2>
<h3 id="please-watch-the-videos-in-the-github-move_to_remote_servermp4-install_and_startupmp4-and-how_to_runmp4-to-see-an-end-to-end-example-of-running-cryosamba">
  PLEASE WATCH THE VIDEOS IN THE GITHUB (move_to_remote_server.mp4, install_and_startup.mp4 and How_to_run.mp4 to see an end-to-end example of running CryoSamba)
  <a class="anchor" href="#please-watch-the-videos-in-the-github-move_to_remote_servermp4-install_and_startupmp4-and-how_to_runmp4-to-see-an-end-to-end-example-of-running-cryosamba">#</a>
</h3>
<p>From <code>Cryosamba/automate</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install streamlit
</span></span><span style="display:flex;"><span>cd automate
</span></span><span style="display:flex;"><span>chmod -R u+x *.sh
</span></span><span style="display:flex;"><span>streamlit run main.py
</span></span></code></pre></div><p>You can set up the environment, train models, make configs, and run inferences from here.</p>
<h2 id="instructions-for-setting-up-cuda">
  Instructions for Setting Up CUDA
  <a class="anchor" href="#instructions-for-setting-up-cuda">#</a>
</h2>
<p>If it appears that your machine is unable to locate the CUDA driver, which is typically found under <code>/usr/bin/</code>, please follow the steps below after identifying the path for CUDA on your machine:</p>
<ol>
<li>
<p><strong>Set the CUDA Home Environment Variable</strong></p>
<p>Run the following command, replacing the path with the correct one for your CUDA installation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>export CUDA_HOME<span style="color:#f92672">=</span>/path/to/your/cuda
</span></span></code></pre></div><p>For example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>export CUDA_HOME<span style="color:#f92672">=</span>/uufs/pathto_/sys/modulefiles/CHPC-r8/Core/cuda/12.2.0.lua
</span></span></code></pre></div></li>
<li>
<p><strong>Ensure CUDA 11 is Installed</strong></p>
<p>Verify that CUDA version 11 is installed on your system. If it is not, please install it according to the official NVIDIA documentation.</p>
</li>
</ol>
<p>By following these steps, your machine should be able to locate and use the CUDA driver, allowing you to proceed with your work.</p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">




  <div>
    <a class="flex align-center" href="https://github.com/alex-shpak/hugo-book/edit/master/exampleSite/content/docs/Active%20Projects/Cryosamba/Project.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="" />
      <span>Edit this page</span>
    </a>
  </div>


</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">
<div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "TKLAB" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#for-hardware-issues-please-refer-to-the-nvidia-cuda-section">For Hardware Issues please refer to the Nvidia-CUDA section</a></li>
    <li><a href="#for-software-issues-please-refer-to-the-python-section-using-conda-environment">For Software Issues please refer to the Python section, Using Conda Environment</a></li>
    <li><a href="#table-of-contents">Table of Contents</a></li>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#cli-tool">CLI Tool</a>
      <ul>
        <li><a href="#installation">Installation</a></li>
        <li><a href="#using-the-tool">Using the Tool</a></li>
      </ul>
    </li>
    <li><a href="#terminal">Terminal</a>
      <ul>
        <li><a href="#installation-1">Installation</a></li>
        <li><a href="#training">Training</a></li>
        <li><a href="#visualization-with-tensorboard">Visualization with TensorBoard</a></li>
        <li><a href="#inference">Inference</a></li>
      </ul>
    </li>
    <li><a href="#ui">UI</a>
      <ul>
        <li><a href="#please-watch-the-videos-in-the-github-move_to_remote_servermp4-install_and_startupmp4-and-how_to_runmp4-to-see-an-end-to-end-example-of-running-cryosamba">PLEASE WATCH THE VIDEOS IN THE GITHUB (move_to_remote_server.mp4, install_and_startup.mp4 and How_to_run.mp4 to see an end-to-end example of running CryoSamba)</a></li>
      </ul>
    </li>
    <li><a href="#instructions-for-setting-up-cuda">Instructions for Setting Up CUDA</a></li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












